{# Import Macros #}
{% import '_helpers/macros.twig' as macros %}

{% set navAboutUs = craft.entries.section('aboutUsStructure').level(1).all() %}
{% set newsOverview = craft.entries.id(3749) %}

{% if navAboutUs is not empty %}
  <ul class="mobile-nav__list mobile-nav__list--hidden">
    {% nav navEntry in navAboutUs %}
    {% set lastUriSegment = navEntry.uri|split('/')|last %}
    <li class="mobile-nav__list-item">
      <a href="{{ navEntry.url }}" class="link">
        <span class="mobile-nav__text {{
          macros.isActive(
            lastUriSegment,
            - 1,
            'mobile-nav__text--'
          )
          }}">
          {{ navEntry.title }}
        </span>
      </a>
      {% ifchildren %}
      <ul class="{{
        navEntry.hasDescendants and navEntry.level == 2
          ? 'nav-main__sublist'
          : 'mobile-nav__list mobile-nav__list--hidden'
        }}">
        {% children %}
      </ul>
      {% endifchildren %}
    </li>

    {% if navEntry.id == 434 %}
      <li class="mobile-nav__list-item">
        <a href="{{ newsOverview.one().url }}" class="link">
          <span class="mobile-nav__text {{
            macros.isActive(
              lastUriSegment,
              - 1,
              'mobile-nav__text--'
            )
            }}">
            {{ newsOverview.one().title }}
          </span>
        </a>
      </li>
    {% endif %}
    {% endnav %}
    {% if
      flyoutGlobals.teaserFlyoutAboutUs is defined
        and flyoutGlobals.teaserFlyoutAboutUs is not empty %}
      {% set teaserFlyout = flyoutGlobals.teaserFlyoutAboutUs.one() %}
      <li class="mobile-nav__list-item">
        <div class="mobile-nav__list-teaser">
          {% include '_components/_teasers/teaser-news.twig' with {
            teaserUrl: teaserFlyout.url,
            teaserPostDate: teaserFlyout.postDate,
            teaserTitle: teaserFlyout.title,
            teaserImage: teaserFlyout.teaserImage.one().url,
            isInFlyout: true
          } %}
        </div>
        <div class="nav-main__link-wrapper">
          <a href="{{ newsOverview.one().url }}"
            class="link link--internal link--icon-after nav-main__teaser-link">
            <span class="link__text">
              {{ 'nav.mainNavigation.goToStories'|t }}
            </span>
            <div class="link__icon-wrapper link__icon-wrapper--internal">
              {{
                macros.svg('arrow_42')|attr({
                  class: 'link__icon link__icon--internal icon icon--42'
                })
              }}
            </div>
          </a>
        </div>
      </li>
    {% endif %}
  </ul>
{% endif %}
