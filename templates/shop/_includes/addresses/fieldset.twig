<!-- Template: {{ _self }}.twig -->
{% set customer = craft.commerce.customers.customer %}
{% set primaryBillingAddress = customer.getPrimaryBillingAddress() %}
{% set primaryShippingAddress = customer.getPrimaryShippingAddress() %}

<div class="js-address-fieldset {{ class }}">
  {% if addresses and currentUser %}

    <div class="">
      {% for address in addresses %}


        {# <label class="radio-container__label address-select js-address-select" data-address-id="{{ address.id }}">
              <div class="radio-container__box">
                <div class="radio-container__radio radio-container__box js-radio">
                  <input type="checkbox" name="{{ name }}Id"
                        data-model-name="{{ name }}"
                      {% if attribute(cart,name~'Id') == address.id %}checked="checked"{% endif %} value="{{ address.id }}"/>
                      {% include 'shop/_includes/addresses/address' %}
                </div>
              </div>
            </label> #}

        {% if
          primaryShippingAddress
          and primaryShippingAddress.id == address.id %}
          <div class="adress-container">
            <div class="radio-container">
              <h2 class="heading heading--2 heading--no-margin-top">
                Versandadresse
              </h2>

              <div class="radio-container__box">
                <div class="radio-container__radio radio-container__box js-radio">
                  {% include 'shop/_includes/addresses/address' %}
                </div>
                <div class="button-container">
                  <a class="button button--primary button--success"
                     href="{{ url('shop/customer/addresses/edit?addressId='~ address.id ~'&redirect='~craft.app.request.fullPath) }}">Bearbeiten</a>
                </div>
              </div>
            </div>
          </div>
        {% endif %}

        {% if
          primaryBillingAddress
          and primaryBillingAddress.id == address.id %}
          <div class="adress-container">
            <div class="radio-container">
              <h2 class="heading heading--2 heading--no-margin-top">
                Rechnungsadresse
              </h2>

              <div class="radio-container__box">
                <div class="radio-container__radio radio-container__box js-radio">
                  {% include 'shop/_includes/addresses/address' %}
                </div>
                <div class="button-container">
                  <a class="button button--primary button--success"
                     href="{{ url('shop/customer/addresses/edit?addressId='~ address.id ~'&redirect='~craft.app.request.fullPath) }}">Bearbeiten</a>
                </div>
              </div>

            </div>

          </div>
        {% endif %}

      {% endfor %}

    </div>
  {% endif %}

  <div class="address-select js-address-select js-address-select-new" data-model-name="{{ name }}">
    {% if attribute(cart, name~'Id') %}
      {% set addressHasErrors = attribute(cart, name).hasErrors() %}
    {% else %}
      {% set addressHasErrors = false %}
    {% endif %}


    {# If we have no addresses expand the 'New Address" fields by default it to being checked.
                   If we have errors on the address also check and expand. #}
    {# {% if currentUser %}
            <div class="js-radio">
                <label>
                  <input type="radio" name="{{ name }}Id"
                         {% if not addresses|length or addressHasErrors %}checked="checked"{% endif %} value=""/>
                  <strong>{{ "Neue" }} {{ title }}</strong>
                </label>
            </div>
        {% endif %} #}

    <div class="js-body {% if currentUser %}hidden{% endif %}">
      {% if addressHasErrors %}<span class="flash">{{ cart.getErrors(name)|join }}</span><br>{% endif %}
      {% include 'shop/_includes/addresses/form' with {
        'modelName': name,
        'address': attribute(cart, name)
      } %}
    </div>
  </div>

</div>{# js-address-fieldset #}
