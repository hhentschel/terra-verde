{% set addresses = addresses ?? [] %}
{% set selectable = selectable ?? false %}
{% set primaryBillingAddressId = primaryBillingAddressId ?? null %}
{% set primaryShippingAddressId = primaryShippingAddressId ?? null %}
{% set cardWidth = cardWidth ?? 'md:w-1/2' %}
{% set showDelete = showDelete ?? false %}
{% set showAdd = showAdd ?? false %}
{% set addUrl = '/shop/customer/addresses/edit?redirect=' ~ craft.app.request.fullPath %}

{% if currentUser %}
  {% if addresses|length %}

    {% for address in addresses %}
      {% set editUrl = '/shop/customer/addresses/edit?addressId=' ~ address.id ~ '&redirect=' ~ craft.app.request.fullPath %}
      <div class="{{ cardWidth }}">
        {% tag selectable ? 'label' : 'div' with {
          class: '',
          data: {
            'address-id': address.id,
          },
        } %}
          <div class="cart-box__select-label">
            {% if selectable %}
              {{ input('radio', name ~ 'Id', address.id, {
                data: {
                  'model-name': name,
                },
                checked: (attribute(cart, sourceIdName) == address.id) or (not attribute(cart, sourceIdName) and address.id == attribute(_context, primaryIdName)),
              }) }}
            {% endif %}
            <span class="cart-box__select-text">
                {{ address|address }}
              </span>

            <span class="adress-item__buttons">
              <a href="{{ url(editUrl) }}"
                 class="button button--primary button--success">
                {{- 'Edit'|t -}}
              </a>
              {% if showDelete and not selectable %}
                <form method="post" action="" class="js-address-delete inline-block">
                  {{ csrfInput() }}
                  {{ actionInput('users/delete-address') }}
                  {{ redirectInput('shop/customer/addresses') }}
                  {{ hiddenInput('addressId', address.id) }}
                  {{ tag('button', {
                    type: 'submit',
                    class: 'button button--secondary',
                    text: 'Delete'|t
                  }) }}
                  {# Outputs a hidden input field #}
                  {{ craft.snaptcha.field }}
                </form>
              {% endif %}
            </span>
          </div>

          {% if primaryBillingAddressId == address.id or primaryShippingAddressId == address.id %}
            <span class="">
                {% if primaryBillingAddressId == address.id %}
                  <div class="adress-item__marker">

                    <svg class="icon--check"
                         xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 20 20"
                         fill="currentColor"
                         role="img" aria-label="Check Mark">
                        <path fill-rule="evenodd"
                              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                              clip-rule="evenodd"/>
                    </svg>
                    <span title="{{ 'Primary billing address'|t }}">{{ 'Primary billing address'|t }}</span>
                </div>
                {% endif %}
              {% if primaryShippingAddressId == address.id %}
                <div class="adress-item__marker">
                    <svg class="icon--check"
                         xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 20 20"
                         fill="currentColor"
                         role="img" aria-label="Check Mark">
                        <path fill-rule="evenodd"
                              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                              clip-rule="evenodd"/>
                    </svg>
                  <span title="{{ 'Primary shipping address'|t }}">{{ 'Primary shipping address'|t }}</span>
                </div>
              {% endif %}
              </span>
          {% endif %}
        {% endtag %}
      </div>
    {% endfor %}

  {% endif %}
  {% if showAdd %}
    <div class="">
      <a href="{{ url(addUrl) }}"
         class="">{{ 'Add address'|t }}</a>
    </div>
  {% endif %}
{% endif %}

{% js %}
  const addressDeletes = document.querySelectorAll('.js-address-delete');
  for (let i = 0; i < addressDeletes.length; i++) {
  addressDeletes[i].addEventListener('submit', ev => {
  if (!confirm('{{ 'Sind Sie sicher, dass Sie diese Adresse l√∂schen wollen?'|t }}')) {
  ev.preventDefault();
  }
  });
  }
{% endjs %}
